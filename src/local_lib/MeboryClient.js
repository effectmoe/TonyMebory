!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MeboryClient=t():e.MeboryClient=t()}(self,(()=>(()=>{"use strict";var e={d:(t,o)=>{for(var s in o)e.o(o,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:o[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>i});class o{static meboryAPI_endpoint="https://api.mebory.com/";static getTitleInfo(){return o.meboryAPI_endpoint+"rest/2ndparty/mebory/getTitleInfo"}static getTitleInfo_result_result_key="result";static getTitleInfo_result_result_value_success="success";static getTitleInfo_result_result_value_failed="failed";static getTitleInfo_result_title_info_key="title_info";static getTitle(){return o.meboryAPI_endpoint+"rest/2ndparty/mebory/00000000-0000-0000-0000-000000000000/getTitle"}static getTitle_result_result_key="result";static getTitle_result_result_value_success="success";static getTitle_result_result_value_failed="failed";static getTitle_result_result_value_issuer_only="issuer_only";static getTitle_result_detailed_mebory_key="detailed_mebory";static getTitle_result_signed_id_key="signed_id";static getTotalPoint(e){return o.meboryAPI_endpoint+"rest/2ndparty/point/"+e+"/getPointSum"}static getTotalPoint_result_point_sum_key="point_sum";static getMeboryShortCode(e,t){return o.meboryAPI_endpoint+"rest/2ndparty/content/"+e+"/"+t+"/shortcode"}static getMeboryShortCode_result_short_code_key="short_code";static getVoucherRecord(e){return o.meboryAPI_endpoint+"rest/2ndparty/purchase/"+e+"/getVoucher"}static getVoucherRecord_result_voucher_record_key="voucher_record"}const s=o;class r{static achievementAPI_endpoint="https://api.mebory.com/";static getStamps(e){return r.achievementAPI_endpoint+"rest/2ndparty/achievement/"+e+"/stamp"}static getStamps_result_stamps_key="stamps";static empty_stamp_event_entry_id="0"}const n=r;class i{constructor(e,t,o){this.refreshAPIUri="https://api.mebory.com/rest/2ndparty/user/refresh",this.loginViewUri="https://login.mebory.com/index.html",this.defaultEndpoint="https://resources.mebory.com";let r=new class{constructor(){}handle403(){console.log("403 error")}handle404(){console.log("404 error")}handle500(){console.log("500 error")}};this.meboryService=new class{constructor(e){this.commonRequestErrorHandling=e,this.token=""}setToken(e){this.token=e}getTitleAsync(e,t,o){e();const r=new Request(s.getTitle(),{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.token},mode:"cors",credentials:"include",method:"GET"});fetch(r).then((e=>{if(t(),200===e.status)return e.json();403===e.status?this.commonRequestErrorHandling.handle403():404===e.status&&this.commonRequestErrorHandling.handle404()})).then((e=>{o(e)})).catch((e=>{}))}async getPointSum(e,t,o,r,n,i){r();const a=new URLSearchParams({title_id:o}),c=new Request(s.getTotalPoint(t)+"?"+a,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.token},mode:"cors",credentials:"include",method:"GET"});if(e)fetch(c).then((e=>{if(n(),200===e.status)return e.json();403===e.status?this.commonRequestErrorHandling.handle403():404===e.status&&this.commonRequestErrorHandling.handle404()})).then((e=>{i(e[s.getTotalPoint_result_point_sum_key])})).catch((e=>{}));else{const e=await fetch(c);if(n(),200===e.status){const t=await e.json();i(t[s.getTotalPoint_result_point_sum_key])}}}async getStamps(e,t,o,s,r){o();const i=new Request(n.getStamps(t),{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.token},mode:"cors",credentials:"include",method:"GET"});if(e)fetch(i).then((e=>{if(s(),200===e.status)return e.json();403===e.status?this.commonRequestErrorHandling.handle403():404===e.status&&this.commonRequestErrorHandling.handle404()})).then((e=>{r(e[n.getStamps_result_stamps_key])})).catch((e=>{}));else{const e=await fetch(i);if(s(),200===e.status){const t=await e.json();r(t[n.getStamps_result_stamps_key])}}}getMeboryShortCode(e,t,o,r,n){o();const i=new Request(s.getMeboryShortCode(t,e),{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.token},mode:"cors",credentials:"include",method:"GET"});fetch(i).then((e=>{if(r(),200===e.status)return e.json();403===e.status?this.commonRequestErrorHandling.handle403():404===e.status&&this.commonRequestErrorHandling.handle404()})).then((e=>{n(e[s.getMeboryShortCode_result_short_code_key])})).catch((e=>{}))}async getVoucherRecord(e,t,o,r,n,i,a,c){i();const l=new URLSearchParams({title_id:o,start_row_num:r,number_of_rows:n}),d=new Request(s.getVoucherRecord(t)+"?"+l,{headers:{"Content-Type":"application/json",Authorization:"Bearer "+this.token},mode:"cors",credentials:"include",method:"GET"});if(e)fetch(d).then((e=>{if(a(),200===e.status)return e.json();403===e.status?this.commonRequestErrorHandling.handle403():404===e.status&&this.commonRequestErrorHandling.handle404()})).then((e=>{c(e[s.getVoucherRecord_result_voucher_record_key])})).catch((e=>{}));else{const e=await fetch(d);if(a(),200===e.status){const t=await e.json();c(t[s.getVoucherRecord_result_voucher_record_key])}}}}(r),this.mebory={},this.isLogined=!1,this.token="",this.tokenexp="",this.rtoken="",this.rtokenexp="";var i=o;window.addEventListener("message",(e=>{e.origin===i&&(this.token=e.data.token,this.tokenexp=e.data.tokenexp,this.rtoken=e.data.rtoken,this.rtokenexp=e.data.rtokenexp,this.isLogined=!0,document.cookie="rtoken="+this.rtoken+"; SameSite=strict; Secure",this.getTitle())}),!1),this.clientId=e,this.loginUIElement=document.getElementById(t),null===this.loginUIElement?console.error("No element"):(this.isLogined=!1,this.loginUIElement.addEventListener("click",(e=>{window.open(this.loginViewUri+"?id="+this.clientId,"_blank")})))}title_front_cover(){return this.defaultEndpoint+"/"+this.mebory.titleId+"/front.png"}product_visual_concept(e,t){return this.defaultEndpoint+"/"+e+"/product/"+t+".png"}title_event_visual_concept_by_id(e,t){return this.defaultEndpoint+"/"+e+"/activity/"+t+".png"}refresh=()=>{const e=document.cookie.split("; ").find((e=>e.startsWith("rtoken=")))?.split("=")[1];if(void 0!==e){this.refreshStarted();const t=new Request(this.refreshAPIUri,{headers:{refreshtoken:e},mode:"cors",credentials:"include",method:"POST",keepalive:!1});fetch(t).then((e=>{if(this.refreshCompleted(),200===e.status)return e.json();throw new Error("Something went wrong on API server!")})).then((e=>{if("success"===e.result){const t=e.token.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=encodeURIComponent(atob(t)),s=decodeURIComponent(o);this.token=e.token,this.tokenexp=JSON.parse(s).exp,this.isLogined=!0,this.getTitle(),this.refreshSucceed()}else this.refreshFailed()})).catch((e=>{this.refreshFailed(),console.error(e)}))}};refreshStarted=()=>{};refreshCompleted=()=>{};refreshSucceed=()=>{};refreshFailed=()=>{};afterLogin=()=>{};getTitleRequestStarted=()=>{};getTitleRequestCompleted=()=>{};getTitleRequestSucceed=e=>{this.mebory=e.detailed_mebory,this.afterLogin()};getTitle=()=>{this.meboryService.setToken(this.token),this.meboryService.getTitleAsync(this.getTitleRequestStarted,this.getTitleRequestCompleted,this.getTitleRequestSucceed)};getPoint=(e,t,o)=>{this.meboryService.getPointSum(!0,this.mebory.meboryId,this.mebory.titleId,e,t,o)};getCode=(e,t,o)=>{this.meboryService.getMeboryShortCode(this.mebory.meboryId,this.mebory.titleId,e,t,o)};getStamp=(e,t,o)=>{this.meboryService.getStamps(!0,this.mebory.titleId,e,t,o)};getVoucher=(e,t,o)=>{this.meboryService.getVoucherRecord(!0,this.mebory.meboryId,this.mebory.titleId,0,100,e,t,o)}}return t})()));